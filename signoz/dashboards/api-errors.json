{
  "title": "LeCopro - Erreurs & Exceptions",
  "description": "Suivi des erreurs, exceptions et codes HTTP 4xx/5xx",
  "tags": ["lecopro", "errors", "exceptions"],
  "layout": [
    {
      "i": "total-errors",
      "x": 0,
      "y": 0,
      "w": 3,
      "h": 2
    },
    {
      "i": "4xx-errors",
      "x": 3,
      "y": 0,
      "w": 3,
      "h": 2
    },
    {
      "i": "5xx-errors",
      "x": 6,
      "y": 0,
      "w": 3,
      "h": 2
    },
    {
      "i": "error-rate",
      "x": 9,
      "y": 0,
      "w": 3,
      "h": 2
    },
    {
      "i": "errors-timeline",
      "x": 0,
      "y": 2,
      "w": 12,
      "h": 3
    },
    {
      "i": "errors-by-status",
      "x": 0,
      "y": 5,
      "w": 6,
      "h": 3
    },
    {
      "i": "errors-by-endpoint",
      "x": 6,
      "y": 5,
      "w": 6,
      "h": 3
    },
    {
      "i": "top-errors-table",
      "x": 0,
      "y": 8,
      "w": 12,
      "h": 4
    },
    {
      "i": "exception-types",
      "x": 0,
      "y": 12,
      "w": 6,
      "h": 3
    },
    {
      "i": "recent-exceptions",
      "x": 6,
      "y": 12,
      "w": 6,
      "h": 3
    }
  ],
  "widgets": [
    {
      "id": "total-errors",
      "title": "Total Erreurs",
      "description": "Nombre total de requêtes en erreur",
      "panelTypes": "value",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "aggregateAttribute": {
                "key": "",
                "dataType": "",
                "type": "",
                "isColumn": false
              },
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "hasError",
                      "dataType": "bool",
                      "type": "tag",
                      "isColumn": true
                    },
                    "op": "=",
                    "value": true
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "legend": "Erreurs",
              "reduceTo": "last"
            }
          ]
        }
      },
      "thresholds": [
        {
          "thresholdValue": 10,
          "thresholdColor": "Yellow",
          "thresholdFormat": "Text",
          "thresholdUnit": "none"
        },
        {
          "thresholdValue": 50,
          "thresholdColor": "Red",
          "thresholdFormat": "Text",
          "thresholdUnit": "none"
        }
      ]
    },
    {
      "id": "4xx-errors",
      "title": "Erreurs 4xx",
      "description": "Erreurs client (400-499)",
      "panelTypes": "value",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "aggregateAttribute": {
                "key": "",
                "dataType": "",
                "type": "",
                "isColumn": false
              },
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "http.status_code",
                      "dataType": "int64",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": ">=",
                    "value": 400
                  },
                  {
                    "key": {
                      "key": "http.status_code",
                      "dataType": "int64",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": "<",
                    "value": 500
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "legend": "4xx",
              "reduceTo": "last"
            }
          ]
        }
      }
    },
    {
      "id": "5xx-errors",
      "title": "Erreurs 5xx",
      "description": "Erreurs serveur (500-599)",
      "panelTypes": "value",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "aggregateAttribute": {
                "key": "",
                "dataType": "",
                "type": "",
                "isColumn": false
              },
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "http.status_code",
                      "dataType": "int64",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": ">=",
                    "value": 500
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "legend": "5xx",
              "reduceTo": "last"
            }
          ]
        }
      },
      "thresholds": [
        {
          "thresholdValue": 1,
          "thresholdColor": "Yellow",
          "thresholdFormat": "Text",
          "thresholdUnit": "none"
        },
        {
          "thresholdValue": 10,
          "thresholdColor": "Red",
          "thresholdFormat": "Text",
          "thresholdUnit": "none"
        }
      ]
    },
    {
      "id": "error-rate",
      "title": "Taux d'erreur",
      "description": "Pourcentage d'erreurs",
      "panelTypes": "value",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "hasError",
                      "dataType": "bool",
                      "type": "tag",
                      "isColumn": true
                    },
                    "op": "=",
                    "value": true
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false
            },
            {
              "dataSource": "traces",
              "queryName": "B",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  }
                ],
                "op": "AND"
              },
              "expression": "B",
              "disabled": false
            }
          ],
          "queryFormulas": [
            {
              "expression": "(A/B)*100",
              "queryName": "F1",
              "legend": "Taux (%)"
            }
          ]
        }
      },
      "thresholds": [
        {
          "thresholdValue": 1,
          "thresholdColor": "Yellow",
          "thresholdFormat": "Text",
          "thresholdUnit": "none"
        },
        {
          "thresholdValue": 5,
          "thresholdColor": "Red",
          "thresholdFormat": "Text",
          "thresholdUnit": "none"
        }
      ]
    },
    {
      "id": "errors-timeline",
      "title": "Erreurs dans le temps",
      "description": "Évolution des erreurs 4xx et 5xx",
      "panelTypes": "graph",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "http.status_code",
                      "dataType": "int64",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": ">=",
                    "value": 400
                  },
                  {
                    "key": {
                      "key": "http.status_code",
                      "dataType": "int64",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": "<",
                    "value": 500
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "stepInterval": 60,
              "legend": "4xx"
            },
            {
              "dataSource": "traces",
              "queryName": "B",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "http.status_code",
                      "dataType": "int64",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": ">=",
                    "value": 500
                  }
                ],
                "op": "AND"
              },
              "expression": "B",
              "disabled": false,
              "stepInterval": 60,
              "legend": "5xx"
            }
          ]
        }
      }
    },
    {
      "id": "errors-by-status",
      "title": "Erreurs par code HTTP",
      "description": "Distribution des codes d'erreur",
      "panelTypes": "pie",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "http.status_code",
                      "dataType": "int64",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": ">=",
                    "value": 400
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "groupBy": [
                {
                  "key": "http.status_code",
                  "dataType": "int64",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "legend": "HTTP {{http.status_code}}"
            }
          ]
        }
      }
    },
    {
      "id": "errors-by-endpoint",
      "title": "Erreurs par endpoint",
      "description": "Top endpoints avec le plus d'erreurs",
      "panelTypes": "bar",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "hasError",
                      "dataType": "bool",
                      "type": "tag",
                      "isColumn": true
                    },
                    "op": "=",
                    "value": true
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "groupBy": [
                {
                  "key": "http.route",
                  "dataType": "string",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "legend": "{{http.route}}",
              "orderBy": {
                "columnName": "A",
                "order": "desc"
              },
              "limit": 10
            }
          ]
        }
      }
    },
    {
      "id": "top-errors-table",
      "title": "Détails des erreurs",
      "description": "Liste détaillée des erreurs récentes",
      "panelTypes": "table",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "hasError",
                      "dataType": "bool",
                      "type": "tag",
                      "isColumn": true
                    },
                    "op": "=",
                    "value": true
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "groupBy": [
                {
                  "key": "http.method",
                  "dataType": "string",
                  "type": "tag",
                  "isColumn": false
                },
                {
                  "key": "http.route",
                  "dataType": "string",
                  "type": "tag",
                  "isColumn": false
                },
                {
                  "key": "http.status_code",
                  "dataType": "int64",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "legend": "{{http.method}} {{http.route}} - {{http.status_code}}",
              "orderBy": {
                "columnName": "A",
                "order": "desc"
              },
              "limit": 20
            }
          ]
        }
      }
    },
    {
      "id": "exception-types",
      "title": "Types d'exceptions",
      "description": "Distribution des types d'exceptions",
      "panelTypes": "pie",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "exception.type",
                      "dataType": "string",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": "exists",
                    "value": ""
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "groupBy": [
                {
                  "key": "exception.type",
                  "dataType": "string",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "legend": "{{exception.type}}"
            }
          ]
        }
      }
    },
    {
      "id": "recent-exceptions",
      "title": "Exceptions récentes",
      "description": "Timeline des exceptions",
      "panelTypes": "graph",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "traces",
              "queryName": "A",
              "aggregateOperator": "count",
              "filters": {
                "items": [
                  {
                    "key": {
                      "key": "service.name",
                      "dataType": "string",
                      "type": "resource",
                      "isColumn": false
                    },
                    "op": "=",
                    "value": "lecopro-api"
                  },
                  {
                    "key": {
                      "key": "exception.type",
                      "dataType": "string",
                      "type": "tag",
                      "isColumn": false
                    },
                    "op": "exists",
                    "value": ""
                  }
                ],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "stepInterval": 60,
              "groupBy": [
                {
                  "key": "exception.type",
                  "dataType": "string",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "legend": "{{exception.type}}"
            }
          ]
        }
      }
    }
  ],
  "variables": {}
}
